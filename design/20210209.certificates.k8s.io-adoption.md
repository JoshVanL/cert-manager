---
title: certificates.k8s.io Adoption
authors:
  - "@joshvanl"
reviewers:
  - "@joshvanl"
approvers:
  - "@munnerz"
  - @jetstack/team-cert-manager
editor: "@joshvanl"
creation-date: 2021-02-09
last-updated: 2021-02-09
status: provisional
---

# certificates.k8s.io Adoption

## Table of Contents

<!-- toc -->
- [Summary](#summary)
- [Motivation](#motivation)
  - [Goals](#goals)
  - [Non-Goals](#non-goals)
- [Reasons For Approach](#reasons-for-approach)
- [Proposal](#proposal)
  - [Signers](#signers)
  - [API Changes](#api-changes)
  - [Upgrading](#upgrading)
  - [Risks and Mitigations](#risks-and-mitigations)
<!-- /toc -->

## Summary

In Kubernetes v1.19 the
[`CertificateSigningRequest`](https://github.com/kubernetes/api/blob/48bd8381a38a486f8b3cdf28cf7334a45b182f2e/certificates/v1/types.go#L41)
resource graduated to `certificates.k8s.io/v1`. This makes the concept of
requesting, signing, and consuming certificates in Kubernetes first class
objects. cert-manager is well placed to serve this resource type as it becomes
more popular in the wider community, whilst preserving all the features and
extensions that cert-manager has to offer.


## Motivation

With the extensiveness of cert-managerâ€™s ecosystem, it is well placed to manage
the core Kubernetes resource type. This gives cert-manager the ability to
integrate with components that it otherwise wouldn't have, without changes to the
third-party project.


### Goals

- Add `CertificateSigningRequest` signer controllers to cert-manager for all
    `Issuer` types

### Non-Goals

- Remove the `CertificateRequest` resource in favour of
    `CertificateSigningRequest`
- Change the `Certificate` controllers behaviour
- Support `CertificateSigningRequest` pre v1
- Make changes to upstream Kubernetes to implement controllers in cert-manager


## Reasons for Approach

Below are a summary of properties of the `CertificateSigningRequest`, and
explanations as to why other approaches to integrate the resource with
cert-manager aren't possible (i.e. completely switching the `CertificateRequest`
resource to `CertificateSigningRequest`:

1. `CertificateSigningRequests` are cluster scoped resources. This means that
   the concept of namespaced `Issuers` doesn't fit with this resource, and any
   attempt to integrate it would open up the ability of privilege escalation
   (i.e. referencing Secrets in another tenants Namespace). Switching to
   `CertificateSigningRequests` would mean the removal of the `Issuer` resource.

1. As `CertificateSigningRequests` are cluster scoped, they do not provide the
   same kind of isolation that `CertificateRequests` provide- preventing tenants
   reading others requests, namespace specific issuer authentication (e.g. Vault
   Kubernetes auth), namespacing cert-manager.

1. `CertificateSigningRequests` do not include a duration field. This means that
   any attempt to "proxy", or copy `CertificateRequests`, would result in a
   regression of this feature. A feature which many users of cert-manager rely
   on.

1. cert-manager has a large number of [external
   issuers](https://cert-manager.io/docs/configuration/external/) created by
   the community that operate over the `CertificateRequest` resource. No longer
   supporting these resources would require these authors to completely re-write
   these issuers to continue to be supported by cert-manager.

Supporting both resource types, but making `CertificateRequests` the "priority"
resource (i.e. the resource created by the `Certificates` controller), means
that we don't have any regression in the features cert-manager offers, whilst
maintaining the same security properties.

## Proposal

Instead of the concept of an `IssuerRef` for `CertificateRequests`,
`CertificateSigningRequests` have the concept of a `SignerName`. Since
`CertificateSigningRequests` are cluster scoped resources, the signer name can
be directly mapped to the `ClusterIssuer` resource. `ClusterIssuers` will be
referenced in the following format:

```yaml
  signerName: cert-manager.io/${ClusterIssuer}
```

Each `CertificateSigningRequest` controller will behave in the same way as the
existing `CertificateRequest` resource, by getting the referenced
`ClusterIssuer`, and attempting to sign. If the `ClusterIssuer` type is not
managed by this controller, do nothing, else sign.

Each `CertificateSigningRequest` controller will automatically set the
`CertificateSigningRequest` `RequestCondition` to `Approved` if the request is
for their managed `ClusterIssuer` type. If the controller manages that
`ClusterIssuer` type, but the `ClusterIssuer` doesn't exist or is not ready, the
controller will set the condition to `Pending`. If signing fails during
processing, it will set the `CertificateSigningRequest` condition to `Failed`.


### Signers

Some special cases for some `ClusterIssuers` that need to be addressed:

- SelfSigned: Makes use of annotations, and so these annotations should also be
    present on `CertificateSigningRequests`.

- Venafi: Makes use of annotations, and so these annotations should also be
    present on `CertificateSigningRequests`.

- ACME: The ACME controller creates sub-resources (`Orders`). Since
    `CertificateSigningRequests` are cluster scoped resources, we should create
    `Orders` in the `Cluster Resource Namespace` (default `cert-manager`).


### API Changes

No API changes are required to support this resource.


### Upgrading

No effect to upgrades as only additional controllers added. No API changes.


### Risks and Mitigations

The controllers need to be aware if the `certificates.k8s.io/v1`
`CertificateSigningRequest` resource exists (e.g. pre v1.19 cluster). If they
don't exist, they should gracefully never start. If the Kubernetes API server
were to be upgraded to a version that does support this resource, cert-manager
will need to be restarted to make use of these controllers. This is acceptable-
worker nodes are typically always restarted during a cluster upgrade.
